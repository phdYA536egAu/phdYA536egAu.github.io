<!DOCTYPE html>
<html>

<head>
	<script type = "text/javascript" src = "https://www.gstatic.com/charts/loader.js">
	</script>
	<script type = "text/javascript">
		google.charts.load('current', {packages: ['corechart','line']});  
	</script>  
    
    <style>

	.left-div {
    	background-color: linen;
	}
	.right-div {
    	background-color: skyblue;
	}

</style>
</head>

<body>
<div class="left-div">
    <p>1.Insere o preco de um PP da unidade que queres gastar.</p>
    <p>(Em baixo, com fundo azul, tens uma ferramenta que te pode ajudar a prever o preco dos PPs a uma certa hora ou num certo dia)</p>
	<input type="text" id="preco_pp" maxlenght="100" value="Preco do PP">

	<p>2.Insere o as unidades por hora geradas em 'Aumento da produção de recursos de 20%' da mina em que vais gastar os PP's (para encontrar carrega em 'Bosque' ou noutra mina) </p>
	<input type="text" id="unidades_hora" maxlenght="100" value="unidades/hora">

	<p>3.Ao fim de uma semana, com o aumento de 20%, produzes mais</p>
	<p id="_x7_x24"></p><p> unidades</p>
	<button onclick="calcula_unidades_semana()">Calcular unidades geradas numa semana</button>

	<p>3.Ao fim de um mes, com o aumento de 20%, produzes mais</p>
	<p id="_x30_x24"></p><p> unidades</p>
	<button onclick="calcula_unidades_mes()">Calcular unidades geradas num mes</button>
    
    <p>4. Com os pp's a este preço, compensa comprar PP's para depois gastar num aumento de 20% da produção da mina que inseriste em 2. ?</p>
	<p id="boolean_compensa_sem">Compensa gastar num aumento de 20% de produção durante uma semana?</p>
    <p id="boolean_compensa_mes">Compensa gastar num aumento de 20% de produção durante uma semana?</p>
	<button onclick="boolean_compensa()">Compensa?</button>
    
    <script>
	function calcula_unidades_semana(){
		var un_h=document.getElementById("unidades_hora").value;
		x7_x24=parseInt(un_h)*7*24;
    
		document.getElementById("_x7_x24").innerHTML = x7_x24;
	}

	function calcula_unidades_mes(){
		var un_h=document.getElementById("unidades_hora").value;
		var x30_x24=parseInt(un_h)*30*24;
    
		document.getElementById("_x30_x24").innerHTML = x30_x24;
	}
    
    function boolean_compensa(){
    	var un_h=document.getElementById("unidades_hora").value;
    	var un_sem=parseInt(un_h)*7*24;
        var un_mes=parseInt(un_h)*30*24;
        var preco_do_pp=document.getElementById("preco_pp").value;
        
        if ( parseInt(preco_do_pp)*40 < un_sem ){
        	document.getElementById("boolean_compensa_sem").innerHTML = "Sim. Se comprares 40 PPs do recurso escolhido em 1. 40 PP's vão-te custar " + 40*parseInt(preco_do_pp) + " unidades mas produzes mais " + un_sem + "unidades do recurso escolhido em 2. numa semana. Vais ganhar " + (40*parseInt(preco_do_pp)-un_sem) + " unidades do recurso escolhido em 2. (depois podes trocar por outros recursos no mercado normal :) )";
        }
        else{
        	document.getElementById("boolean_compensa_sem").innerHTML = "Não. Se comprares 40 PPs do recurso escolhido em 1. 40 PP's vão-te custar " + 40*parseInt(preco_do_pp) + " unidades mas só produzes mais " + un_sem + "unidades do recurso escolhido em 2. numa semana por tanto vais gastar " +  (un_sem-40*parseInt(preco_do_pp)) + " unidades do recurso escolhido em 2. desnecessariamente.";
        }
        
        if ( parseInt(preco_do_pp)*150 < un_mes ){
        	document.getElementById("boolean_compensa_mes").innerHTML = "Sim. Se comprares 150 PPs do recurso escolhido em 1. 150 PP's vão-te custar " + 150*parseInt(preco_do_pp) + " unidades mas produzes mais " + un_mes + "unidades do recurso escolhido em 2. num mês. Vais ganhar " + (150*parseInt(preco_do_pp)-un_sem) + " unidades do recurso escolhido em 2. (depois podes trocar por outros recursos no mercado normal :) )";
        }
        else{
        	document.getElementById("boolean_compensa_mes").innerHTML = "Não. Se comprares 150 PPs do recurso escolhido em 1. 150 PP's vão-te custar " + 150*parseInt(preco_do_pp) + " unidades mas só produzes mais " + un_mes + "unidades do recurso escolhido em 2. num mês por tanto vais gastar " +  (un_sem-150*parseInt(preco_do_pp)) + " unidades do recurso escolhido em 2. desnecessariamente.";
        }
    }
        
	</script>
</div>


<div class="right-div">
<p>Escolhe um mundo: </p>
<input type="text" id="myWorld" maxlenght="99999" value="Exemplo:'74'">

<p>Copia e cola as linhas COMPLETAS do teu historico de pontos ->meter aqui um exemplo>- </p>
<input type="text" id="myText" maxlenght="99999" value="Maximo: 99.999 caracteres. Copia uma linha para aqui.">
<button onclick="mainFunction()">Calcular custo dos PP's comprados</button>

<p>Teste:</p>
<p id="teste"></p>
<p>Teste2:</p>
<p id="teste2"></p>
<p>Input:</p>
<p id="input"></p>
<p>Total pp's comprados:</p>
<p id="total_pps"></p>
<p>Total pp's usados:</p>
<p id="total_pps_usados"></p>
<p>Total gasto em madeira:</p>
<p style="color:brown; font-weight:bold;" id="total_madeira"></p>
<p >Total gasto em argila:</p>
<p style="color:orange; font-weight:bold;" id="total_argila"></p>
<p>Total gasto em ferro:</p>
<p style="color:darkgrey; font-weight:bold;" id="total_ferro"></p>
<p>Precos pp:</p>
<p id="pp"></p>
<p>Mundo de uma linha:</p>
<p id="mundo_da_linha"></p>

<div id = "chartMadeira" style = "width: 550px; height: 400px; margin: 0 auto">
</div>
<div id = "chartArgila" style = "width: 550px; height: 400px; margin: 0 auto">
</div>
<div id = "chartFerro" style = "width: 550px; height: 400px; margin: 0 auto">
</div>

<script>
var lines = [];
var linesLength;

var text, i, bool;
var line="";
var line_counter=0;

var total_pps_comprados=0;
var total_pps_usados=0;

var total_gasto_em_madeira=0;
var total_gasto_em_argila=0;
var total_gasto_em_ferro=0;

var precos_madeira=[];
var precos_argila=[];
var precos_ferro=[];
var madeira_cont=0;
var argila_cont=0;
var ferro_cont=0;

function obterMundo(linha_introduzida){
	var mundo = linha_introduzida;
    
    mundo = mundo.slice(mundo.indexOf("M")+6, mundo.indexOf("M")+8);
    
    return mundo;
}

function displayLines(){
  linesLength = lines.length;

  text = "<ul>";
  for (i = 0; i < linesLength; i++) {
       text += "<li>" + lines[i] + "</li>";
  }
  text += "</ul>";

  document.getElementById("input").innerHTML = text;

}

function obterLinhas(mundo_e){
    var input = document.getElementById("myText").value;

    for (i = 0; i < input.length; i++) {
        bool=input.substr(i, 1).localeCompare(")");
        if ( bool ){
            line = line.concat(input.substr(i, 1));
        }
        else{	
        	if ( mundo_e==obterMundo(line) ){
				var pos_transf = line.indexOf("Transferir");
			
    			if (pos_transf != -1 ){
            		total_pps_comprados+=obter_pps_comprados();
            	}
            	var pos_ut = line.indexOf("Utilizados");

    			if (pos_ut != -1 ){
            		total_pps_usados+=obter_pps_usados();
            	}
            	lines[line_counter]=line;
            	line_counter+=1;
            	line="";
            }
        }
    }
}



function obter_qtd_de_recurso_gasto(linha_sem_principio, prim_esp){
	var qtd="";
    var tipo_de_recurso;
	if ( linha_sem_principio.search("Madeira") != -1 ){
    	//Obter qtd de madeira gasta a comprar os pps
        qtd=linha_sem_principio.slice(linha_sem_principio.indexOf("(")+1, linha_sem_principio.length);
        total_gasto_em_madeira += parseInt(qtd);
        tipo_de_recurso=1;
    }
    
    if ( linha_sem_principio.search("Argila") != -1 ){
    	//Obter qtd de argila gasta a comprar os pps
        qtd=linha_sem_principio.slice(linha_sem_principio.indexOf("(")+1, linha_sem_principio.length);
        total_gasto_em_argila += parseInt(qtd);
        tipo_de_recurso=2;
    }

	if ( linha_sem_principio.search("Ferro") != -1 ){
    	//Obter qtd de ferro gasto a comprar os pps
        qtd=linha_sem_principio.slice(linha_sem_principio.indexOf("(")+1, linha_sem_principio.length);
        total_gasto_em_ferro += parseInt(qtd);
        tipo_de_recurso=3;
    }
    
    return [parseInt(qtd), tipo_de_recurso];
}

function obter_valor_da_data(data_str){
	var mes_str;
    var mes_num;
    var dia_str;
    var hora_str;
    var min_str;
    
	//Obter mes
    mes_str = data_str.slice(2, 5);
    
    //Transformar mes(string) num numero
    switch(mes_str){
    	case "jan":
        	mes_num=1;
            break;
        case "fev":
        	mes_num=2;
            break;
        case "mar":
        	mes_num=3;
            break;
        case "abr":
        	mes_num=4;
            break;
        case "mai":
        	mes_num=5;
            break;
        case "jun":
        	mes_num=6;
            break;
        case "jul":
        	mes_num=7;
            break;
        case "ago":
        	mes_num=8;
            break;
        case "set":
        	mes_num=9;
            break;
        case "out":
        	mes_num=10;
            break;
        case "nov":
        	mes_num=11;
            break;
        case "dez":
        	mes_num=12;
    }
    
	//Obter dia
    dia_str=data_str.slice(data_str.indexOf(",")-3, data_str.indexOf(","));
 
    //Obter hora
    hora_str=data_str.slice(data_str.indexOf(",")+1, data_str.indexOf(":"));
    
    //Obter min
    min_str=data_str.slice(data_str.indexOf(":")+1, data_str.indexOf("M"));
    
    return mes_num*(31*24*60)+parseInt(dia_str)*(24*60)+(parseInt(hora_str)+1)*60+(parseInt(min_str)+1);
    
}

function obter_pps_comprados(){
    var pos_transf = line.indexOf("Transferir");
    var qtd_e_tiporecurso;
    var data;
    var valor;

    if (pos_transf != -1 ){
    	data = line.slice(0, line.indexOf("M"));
        valor = obter_valor_da_data(data);
    
        var line_sem_principio = line.slice(pos_transf+10);
        var primeiro_espaco = line_sem_principio.lastIndexOf(" ");
       
        qtd_e_tiporecurso = obter_qtd_de_recurso_gasto(line_sem_principio, primeiro_espaco);
               
        var pps_comprados = line_sem_principio.slice(0, line_sem_principio.length-primeiro_espaco+1);
        
        switch (qtd_e_tiporecurso[1]){
        	case 1:
            	precos_madeira[madeira_cont]=[valor, parseInt(qtd_e_tiporecurso[0])/parseInt(pps_comprados), , ,];
                madeira_cont+=1;
        		break;
            case 2:
            	precos_argila[argila_cont]=[valor, parseInt(qtd_e_tiporecurso[0])/parseInt(pps_comprados), , ,];
                argila_cont+=1;
        		break;
            case 3:
            	precos_ferro[ferro_cont]=[valor, parseInt(qtd_e_tiporecurso[0])/parseInt(pps_comprados), , ,];
                ferro_cont+=1;
        }
        return parseInt(pps_comprados);  
    }
}

function obter_pps_usados(){
    var pos_ut = line.indexOf("Utilizados");

    if (pos_ut != -1 ){
        var line_sem_principio = line.slice(pos_ut+10);
        var primeiro_espaco = line_sem_principio.lastIndexOf(" ");
        var pps_us = line_sem_principio.slice(0, line_sem_principio.length-primeiro_espaco+5); //nao deveria funcionar quando os novos pontos premium nao tem 3 digitos

        return parseInt(pps_us); 
    } 
}

function mainFunction() {
  var text;
  
  //Obter mundo escolhido pelo utilizador
  var mundo_escolhido = document.getElementById("myWorld").value;
  
  obterLinhas(mundo_escolhido);

  displayLines();

  document.getElementById("total_pps").innerHTML = total_pps_comprados;
  document.getElementById("total_pps_usados").innerHTML = total_pps_usados;

  document.getElementById("total_madeira").innerHTML = total_gasto_em_madeira;   
  document.getElementById("total_argila").innerHTML = total_gasto_em_argila;
  document.getElementById("total_ferro").innerHTML = total_gasto_em_ferro;
  
  text = "<ul>";
  
  for (i = 0; i < precos_madeira.length; i++) {
  	text += '<li>' + precos_madeira[i][0] + ":::" + precos_madeira[i][1] + "--" + precos_madeira[i][2] + "--" + precos_madeira[i][3] + "--" + precos_madeira[i][4]+"</li>";
  }
  
  text += "</ul>";
  
  document.getElementById("pp").innerHTML = text;
  
  drawChartMadeira();
  drawChartArgila();
  drawChartFerro();
}

//------CHARTS---------//
function drawChartMadeira() {
            // Define the chart to be drawn.
            var data = new google.visualization.DataTable();
            data.addColumn('number', 'String');
            data.addColumn('number', 'Madeira');
            data.addColumn('number', 'Ignore this');
            data.addColumn('number', 'Ignore this');
            data.addRows(precos_madeira);
               
            // Set chart options
            var options = {'title' : 'Quanto custa comprar 1PP com madeira:',
               hAxis: {
                  title: 'Data'
               },
               vAxis: {
                  title: 'Recurso'
               },   
               'width':550,
               'height':400,
               colors:['brown'],
               pointsVisible: true	  
            };

            // Instantiate and draw the chart.
            var chart = new google.visualization.LineChart(document.getElementById('chartMadeira'));
            chart.draw(data, options);
         }
         google.charts.setOnLoadCallback(drawChartMadeira);
         
function drawChartArgila() {
            // Define the chart to be drawn.
            var data_arg = new google.visualization.DataTable();
            data_arg.addColumn('number', 'String');
            data_arg.addColumn('number', 'Argila');
            data_arg.addColumn('number', 'Ignore this');
            data_arg.addColumn('number', 'Ignore this');
            data_arg.addRows(precos_argila);
               
            // Set chart options
            var options_arg = {'title' : 'Quanto custa comprar 1PP com argila:',
               hAxis: {
                  title: 'Data'
               },
               vAxis: {
                  title: 'Recurso'
               },   
               'width':550,
               'height':400,
               colors:['yellow'],
               pointsVisible: true	  
            };

            // Instantiate and draw the chart.
            var chart_arg = new google.visualization.LineChart(document.getElementById('chartArgila'));
            chart_arg.draw(data_arg, options_arg);
}

google.charts.setOnLoadCallback(drawChartArgila);
function drawChartFerro() {
            // Define the chart to be drawn.
            var data_ferr = new google.visualization.DataTable();
            data_ferr.addColumn('number', 'String');
            data_ferr.addColumn('number', 'Ferro');
            data_ferr.addColumn('number', 'Ignore this');
            data_ferr.addColumn('number', 'Ignore this');
            data_ferr.addRows(precos_ferro);
               
            // Set chart options
            var options_ferr = {'title' : 'Quanto custa comprar 1PP com ferro:',
               hAxis: {
                  title: 'Data'
               },
               vAxis: {
                  title: 'Recurso'
               },   
               'width':550,
               'height':400,
               colors:['blue'],
               pointsVisible: true	  
            };

            // Instantiate and draw the chart.
            var chart_ferr = new google.visualization.LineChart(document.getElementById('chartFerro'));
            chart_ferr.draw(data_ferr, options_ferr);
}

google.charts.setOnLoadCallback(drawChartFerro);
</script>

</div>
</body>
</html>
