<!DOCTYPE html>
<html>

<head>
	<script type = "text/javascript" src = "https://www.gstatic.com/charts			/loader.js">
	</script>
	<script type = "text/javascript">
		google.charts.load('current', {packages: ['corechart','line']});  
	</script>     
</head>

<body>

<p>1.Insere o numero de pps que queres gastar</p>
<input type="text" id="pps_a_gastar" maxlenght="100" value="pp's a gastar">

<p>2.Insere o as unidades por hora geradas em 'Aumento da produção de recursos de 20%' (para encontrar carrega em 'Bosque') </p>
<input type="text" id="unidades_hora" maxlenght="100" value="unidades/hora">

<script>
function calcula_unidades_semana(){
	var un_h=document.getElementById("unidades_hora").value;
	var x7_x24=parseInt(un_h)*7*24;
    
	document.getElementById("_x7_x24").innerHTML = x7_x24;
}

function calcula_unidades_mes(){
	var un_h=document.getElementById("unidades_hora").value;
	var x30_x24=parseInt(un_h)*30*24;
    
	document.getElementById("_x30_x24").innerHTML = x30_x24;
}
</script>

<p>3.Ao fim de uma semana, com o aumento de 20%, produzes mais</p>
<p id="_x7_x24"></p><p> unidades</p>
<button onclick="calcula_unidades_semana()">Calcular unidades geradas numa semana</button>

<p>3.Ao fim de um mes, com o aumento de 20%, produzes mais</p>
<p id="_x30_x24"></p><p> unidades</p>
<button onclick="calcula_unidades_mes()">Calcular unidades geradas num mes</button>

<p>---------------------------------------------------------------</p>
<p>Copia e cola TODAS as linhas do teu historico de pontos</p>

<input type="text" id="myText" maxlenght="10000" value="Some text...">

<button onclick="mainFunction()">Calcular custo dos PP's comprados</button>

<p>Teste:</p>
<p id="teste"></p>
<p>Input:</p>
<p id="input"></p>
<p>Total pp's comprados:</p>
<p id="total_pps"></p>
<p>Total pp's usados:</p>
<p id="total_pps_usados"></p>
<p>Total gasto em madeira:</p>
<p style="color:brown;" id="total_madeira"></p>
<p >Total gasto em argila:</p>
<p style="color:orange;" id="total_argila"></p>
<p>Total gasto em ferro:</p>
<p style="color:darkgrey;" id="total_ferro"></p>
<p>Precos pp:</p>
<p id="pp"></p>

<div id = "container" style = "width: 550px; height: 400px; margin: 0 auto">
</div>

<script>
var lines = [];
var linesLength;

var text, i, bool;
var line="";
var line_counter=0;

var total_pps_comprados=0;
var total_pps_usados=0;

var total_gasto_em_madeira=0;
var total_gasto_em_argila=0;
var total_gasto_em_ferro=0;

var precos_madeira=[];
var madeira_cont=0;

function displayLines(){
  linesLength = lines.length;

  text = "<ul>";
  for (i = 0; i < linesLength; i++) {
       text += "<li>" + lines[i] + "</li>";
  }
  text += "</ul>";

  document.getElementById("input").innerHTML = text;

}

function obterLinhas(){
    var input = document.getElementById("myText").value;

    for (i = 0; i < input.length; i++) {
        bool=input.substr(i, 1).localeCompare(")");
        if ( bool ){
            line = line.concat(input.substr(i, 1));
        }
        else{
        	var pos_transf = line.indexOf("Transferir");

    		if (pos_transf != -1 ){
            	total_pps_comprados+=obter_pps_comprados();
            }
            var pos_ut = line.indexOf("Utilizados");

    		if (pos_ut != -1 ){
            	total_pps_usados+=obter_pps_usados();
            }
            lines[line_counter]=line;
            line_counter+=1;
            line="";
        }
    }
}



function obter_qtd_de_recurso_gasto(linha_sem_principio, prim_esp){
	var qtd="";
	if ( linha_sem_principio.search("Madeira") != -1 ){
    	//Obter qtd de madeira gasta a comprar os pps
        qtd=linha_sem_principio.slice(linha_sem_principio.indexOf("(")+1, linha_sem_principio.length);
        total_gasto_em_madeira += parseInt(qtd);
    }
    
    if ( linha_sem_principio.search("Argila") != -1 ){
    	//Obter qtd de argila gasta a comprar os pps
        qtd=linha_sem_principio.slice(linha_sem_principio.indexOf("(")+1, linha_sem_principio.length);
        total_gasto_em_argila += parseInt(qtd);        
    }

	if ( linha_sem_principio.search("Ferro") != -1 ){
    	//Obter qtd de ferro gasto a comprar os pps
        qtd=linha_sem_principio.slice(linha_sem_principio.indexOf("(")+1, linha_sem_principio.length);
        total_gasto_em_ferro += parseInt(qtd);       
    }
    
    return parseInt(qtd);
}

function obter_valor_da_data(data_str){
	var mes_str;
    var mes_num;
    var dia_str;
    var hora_str;
    var min_str;
    
	//Obter mes
    mes_str = data_str.slice(0, data_str.indexOf(" "));
    
    //Transformar mes(string) num numero
    switch(mes_str){
    	case "jan":
        	mes_num=1;
            break;
        case "fev":
        	mes_num=2;
            break;
        case "mar":
        	mes_num=3;
            break;
        case "abr":
        	mes_num=4;
            break;
        case "mai":
        	mes_num=5;
            break;
        case "jun":
        	mes_num=6;
            break;
        case "jul":
        	mes_num=7;
            break;
        case "ago":
        	mes_num=8;
            break;
        case "set":
        	mes_num=9;
            break;
        case "out":
        	mes_num=10;
            break;
        case "nov":
        	mes_num=11;
            break;
        case "dez":
        	mes_num=12;
    }
    
	//Obter dia
    dia_str=data_str.slice(data_str.indexOf(" "), data_str.indexOf(","));
 
    //Obter hora
    hora_str=data_str.slice(data_str.indexOf(",")+1, data_str.indexOf(":"));
    
    //Obter min
    min_str=data_str.slice(data_str.indexOf(":")+1, data_str.indexOf("M"));
    
    return mes_num*12/(31*24*60)+parseInt(dia_str)*31/(24*60)+(parseInt(hora_str)+1)*24/60+(parseInt(min_str)+1)*60;
    
}

function obter_pps_comprados(){
    var pos_transf = line.indexOf("Transferir");
    var qtd;
    var data;
    var valor;

    if (pos_transf != -1 ){
    	data = line.slice(0, line.indexOf("M"));
        
        valor = obter_valor_da_data(data);
    
        var line_sem_principio = line.slice(pos_transf+10);
        var primeiro_espaco = line_sem_principio.lastIndexOf(" ");
       
        qtd = obter_qtd_de_recurso_gasto(line_sem_principio, primeiro_espaco);
               
        var pps_comprados = line_sem_principio.slice(0, line_sem_principio.length-primeiro_espaco+1);
        
        precos_madeira[madeira_cont]=[data, parseInt(qtd)/parseInt(pps_comprados), 1, 1, 1];
        madeira_cont+=1;

        return parseInt(pps_comprados);  
    }
}

function obter_pps_usados(){
    var pos_ut = line.indexOf("Utilizados");

    if (pos_ut != -1 ){
        var line_sem_principio = line.slice(pos_ut+10);
        var primeiro_espaco = line_sem_principio.lastIndexOf(" ");
        var pps_us = line_sem_principio.slice(0, line_sem_principio.length-primeiro_espaco+5); //nao deveria funcionar quando os novos pontos premium nao tem 3 digitos

        return parseInt(pps_us); 
    } 
}

function mainFunction() {
  var text;
  obterLinhas();

  displayLines();

  document.getElementById("total_pps").innerHTML = total_pps_comprados;
  document.getElementById("total_pps_usados").innerHTML = total_pps_usados;

  document.getElementById("total_madeira").innerHTML = total_gasto_em_madeira;   
  document.getElementById("total_argila").innerHTML = total_gasto_em_argila;
  document.getElementById("total_ferro").innerHTML = total_gasto_em_ferro;
  
  text = "<ul>";
  
  for (i = 0; i < precos_madeira.length; i++) {
  	text += '<li>' + precos_madeira[i][0] + ":::" + precos_madeira[i][1] + "--" + precos_madeira[i][2] + "--" + precos_madeira[i][3] + "--" + precos_madeira[i][4]+"</li>";
  }
  
  text += "</ul>";
  
  document.getElementById("pp").innerHTML = text;
}

//------CHARTS---------//
function drawChart() {
            // Define the chart to be drawn.
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Month');
            data.addColumn('number', 'Madeira');
            data.addColumn('number', 'Argila');
            data.addColumn('number', 'Ferro');
            data.addColumn('number', 'PPs na conta');
            data.addRows(precos_madeira);
               
            // Set chart options
            var options = {'title' : 'Average Temperatures of Cities',
               hAxis: {
                  title: 'Month'
               },
               vAxis: {
                  title: 'Temperature'
               },   
               'width':550,
               'height':400,
               pointsVisible: true	  
            };

            // Instantiate and draw the chart.
            var chart = new google.visualization.LineChart(document.getElementById('container'));
            chart.draw(data, options);
         }
         google.charts.setOnLoadCallback(drawChart);
</script>


</body>
</html>
